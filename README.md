# Плагин для анализа Flaky-тестов в Playwright (flaky-analyzer)

Этот проект представляет собой плагин для Playwright (`flaky-analyzer`) и сопутствующий дашборд (`flaky-analyzer-dashboard`), предназначенные для обнаружения, анализа и помощи в диагностике нестабильных (flaky) тестов в проектах на Playwright. Он собирает подробную информацию о каждой попытке выполнения теста, выявляет тесты с непостоянными результатами и предоставляет веб-интерфейс для визуализации этих результатов и потенциальных причин нестабильности.

## Основные компоненты

1.  **`flaky-analyzer` (Плагин):** Репортер Playwright, который собирает данные о выполнении тестов (статус, длительность, ошибки, вложения, такие как трейсы/скриншоты/видео) и идентифицирует flaky-тесты.
2.  **`flaky-analyzer-dashboard` (Дашборд):** Веб-приложение, которое читает файл отчет репортера и отображает интерактивную панель для анализа flaky-тестов, показывая детали попыток, сводку ошибок и  потенциальные причины нестабильности.

## Требования

*   Node.js и npm
*   Проект на Playwright

## Установка

1.  **Клонируйте репозиторий** плагина и дашборда в ваш проект:
    ```bash
    git clone https://github.com/milkylake/flaky-analyzer
    cd ..
    ```

2.  **Установите зависимости для плагина**:
    ```bash
    cd flaky-analyzer-plugin
    npm install
    cd ..
    ```

3.  **Установите зависимости для дашборда**:
    ```bash
    cd flaky-analyzer-dashboard
    npm install
    cd ..
    ```

4.  **Настройте репортер Playwright**:
    Откройте ваш файл конфигурации Playwright (`playwright.config.ts` или `.js`) и добавьте `flaky-analyzer` в массив `reporter`. Укажите корректный относительный путь к директории плагина, если вы клонировали его в другое место.
    ```typescript
    import { defineConfig } from '@playwright/test';

    export default defineConfig({
      // ... другие настройки
      retries: process.env.CI ? 2 : 3, // Пример: рекомендуется иметь повторы для обнаружения flaky-тестов
      reporter: [
        ['./flaky-analyzer/flaky-analyzer-plugin'] // Путь к директории плагина
      ],
      // ... другие настройки
    });
    ```

## Использование

1.  **Запустите ваши тесты Playwright** как обычно:
    ```bash
    npx playwright test
    ```
    Во время выполнения плагин `flaky-analyzer` будет собирать данные и по завершении создаст отчет в корневой директории вашего проекта (или там, где запускается Playwright).

2.  **Запустите Дашборд для анализа**:
    Перейдите в директорию дашборда и запустите его:
    ```bash
    cd flaky-analyzer-dashboard
    npm run dev
    ```
    Откройте браузер и перейдите по адресу `http://localhost:8080` (или по порту, указанному в вашем терминале), чтобы просмотреть дашборд и проанализировать результаты тестов.

## Руководитель

*   **В.А. Пархоменко** (ст. преподаватель ФГАОУ ВО «СПбПУ»)